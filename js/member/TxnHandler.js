"undefined"==typeof TxnHandler&&(TxnHandler={});
(function(){function x(a,c,e){return a+"_"+c.replace(".","_")+"_"+e}function y(a,c){for(var e=$j("#openBetSelectionBox"),b=0;b<=a.length-1;b++){var f=a[b],r=f.status;if("txn"==c||"sportsBookTxn"==c||"fancyBetTxn"==c||"bookMakerTxn"==c||"financialTxn"==c){if(MyTransactionUtils.isSettle(r))continue}else if("unMatchTicket"==c||"sportsBookUnMatchTicket"==c)if(UnMatchTicketUtil.isDelete(r)||UnMatchTicketUtil.isLapsed(r))continue;r=f.eventType;var p=f.categoryType,m=f.eventId,t=f.eventName.replace("v",
"vs"),q=f.marketId,v=f.marketName,G=q.replace(".","_");if(0==$j("#option_"+x(m,G,p)).length){!isNaN(A)&&0!=A||void 0!=B&&""!=B||(A=m,B=q,z=p);var I=JsCache.clone("#optionTemplate");I.attr("id","option_"+x(m,G,p));I.attr("eventType",r).attr("eventId",m).attr("marketId",q);I.attr("categoryType",p);I.html(t+" - "+v);m==A&&q==B&&p==z&&I.prop("selected","selected");"txn"==c||"sportsBookTxn"==c||"fancyBetTxn"==c||"bookMakerTxn"==c||"financialTxn"==c?I.attr("date",f.transactionDate):("unMatchTicket"==c||
"sportsBookUnMatchTicket"==c)&&I.attr("date",f.createDate);e.find("select").append(I.show())}}a=$j("[id^='option_']");a.sort(function(J,K){J=$j(J);K=$j(K);return-1*J.attr("date").localeCompare(K.attr("date"))});e.find("select").append(a)}function D(a,c){return c?c:a}function F(a){try{$j.ajax({type:"POST",dataType:"JSON",url:(PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost?QueryDataSubDomainUtil.queryHost:"")+"/member/playerService/queryUnMatchTicketsAndTxns",data:{unMatchTicketVersion:a.unMatchTicketVersion,
txnVersion:a.txnVersion,sportsBookUnMatchTicketVersion:a.sportsBookUnMatchTicketVersion,sportsBookTxnVersion:a.sportsBookTxnVersion,fancyBetTxnVersion:a.fancyBetTxnVersion,bookMakerTxnVersion:a.bookMakerTxnVersion,financialTxnVersion:a.financialTxnVersion,queryPass:PageConfig.queryPass},xhrFields:{withCredentials:!0},success:function(c){if(null!=c){var e=!1,b=[];if(c.unMatchTicketVersion>a.unMatchTicketVersion&&0<c.unMatchTickets.length){var f=DataBase.unMatchTicket.update(c.unMatchTickets);E();a.unMatchTicketVersion=
Math.max(c.unMatchTicketVersion,a.unMatchTicketVersion);1==f&&(e=!0);C(c.unMatchTickets,b)}c.txnVersion>a.txnVersion&&0<c.txns.length&&(DataBase.txn.update(c.txns),n(),a.txnVersion=Math.max(c.txnVersion,a.txnVersion),e=!0,C(c.txns,b));c.sportsBookUnMatchTicketVersion>a.sportsBookUnMatchTicketVersion&&0<c.sportsBookUnMatchTickets.length&&(f=DataBase.sportsBookUnMatchTicket.update(c.sportsBookUnMatchTickets),E(),a.sportsBookUnMatchTicketVersion=Math.max(c.sportsBookUnMatchTicketVersion,a.sportsBookUnMatchTicketVersion),
1==f&&(e=!0),C(c.sportsBookUnMatchTickets,b));c.sportsBookTxnVersion>a.sportsBookTxnVersion&&0<c.sportsBookTxns.length&&(DataBase.sportsBookTxn.update(c.sportsBookTxns),n(),a.sportsBookTxnVersion=Math.max(c.sportsBookTxnVersion,a.sportsBookTxnVersion),e=!0,C(c.sportsBookTxns,b));c.fancyBetTxnVersion>a.fancyBetTxnVersion&&0<c.fancyBetTxns.length&&(DataBase.fancyBetTxn.update(c.fancyBetTxns),n(),a.fancyBetTxnVersion=Math.max(c.fancyBetTxnVersion,a.fancyBetTxnVersion),e=!0,C(c.fancyBetTxns,b));c.bookMakerTxnVersion>
a.bookMakerTxnVersion&&0<c.bookMakerTxns.length&&(DataBase.bookMakerTxn.update(c.bookMakerTxns),n(),a.bookMakerTxnVersion=Math.max(c.bookMakerTxnVersion,a.bookMakerTxnVersion),e=!0,C(c.bookMakerTxns,b));c.financialTxnVersion>a.financialTxnVersion&&0<c.financialTxns.length&&(DataBase.financialTxn.update(c.financialTxns),n(),a.financialTxnVersion=Math.max(c.financialTxnVersion,a.financialTxnVersion),e=!0,C(c.financialTxns,b));if(e){c=!1;if(0<b.length)for(e=0;e<b.length;e++){f=b[e].split("_");var r=
f[2];CategoryType.BETFAIR.unique()==r?(BetHandler.getWinLoss(f[0],f[1]),c=!0,f=DataBase.markets.get(f[0],f[1]),MarketUtil.isAsiaHandicapMarket(f)&&null!=PageConfig.selectMarketId&&PageConfig.selectMarketId==f.marketId&&(ExposureUtil.calculatePlTable(f),AsianHandicapPlTableUtil.renderAsianHandicapPlTable(f))):CategoryType.FANCY_BET.unique()==r?(FancyBetHandler.getExposure(f[0],f[1]),FancyBetMarketHandler.showFancyBetBookBtn(f[0],f[1])):CategoryType.SPORTRADAR_SPORTSBOOK.unique()==r?SportsBookBetHandler.getExposure(ApiSiteType.SPORTRADAR.unique(),
f[0],f[1]):CategoryType.BOOK_MAKER.unique()==r?BookMakerBetHandler.getExposure(f[0],f[1]):CategoryType.TS_BINARY.unique()==r&&(FinancialBetHandler.getExposure(ApiSiteType.TS.unique(),f[0],f[1]),FinancialMarketBookHandler.showBookBtn(ApiSiteType.TS.unique(),f[0],f[1]))}TxnHandler.updateOpenBetSelectionBox();c&&TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets()}L&&null!=PageConfig.selectMarketId&&(TxnHandler.changeOpenBetInFullMarkets(PageConfig.selectEventId,
PageConfig.selectMarketId),L=!1)}},error:function(){PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost&&!QueryDataSubDomainUtil.isLineDown&&(QueryDataSubDomainUtil.queryHost=null,QueryDataSubDomainUtil.isLineDown=!0)}})}catch(c){Trace.printStackTrace(c)}finally{a.check(),TaskExecuter.execute()}}function C(a,c){for(var e in a){var b=a[e];b=b.eventId+"_"+b.marketId+"_"+b.categoryType;-1==ArrayUtil.indexOf(c,b)&&c.push(b)}}function E(){var a=TxnHandler.isShowBetInfo;DataBase.unMatchTicket.calculatePL();
DataBase.sportsBookUnMatchTicket.calculatePL();for(var c=DataBase.unMatchTicket.queryAll(),e=H(),b=0;b<=c.length-1;b++){var f=c[b];if(f.eventId==A&&f.marketId==B&&f.categoryType==z)a:{var r=a,p=e;var m=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:m.symbol});var t=JsCache.get("#unMatchTicketList"),q=SideType.getInstanceOf(f.sideType),v=f.persistenceType;m=SideType.Back.unique()==q.value?t.find("#backSlipHeader"):t.find("#laySlipHeader");t=$j("#unMatchTicket_"+
f.id);if(0==t.length){if(UnMatchTicketUtil.isDelete(f.status)||UnMatchTicketUtil.isLapsed(f.status)||1==f.summary||0==f.lastPrice)break a;t=JsCache.clone("#unMatchTicketTemplate");t.attr("class","slip-"+q.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(q.name));t.attr("id","unMatchTicket_"+f.id).attr("unMatchTicketId",f.id).attr("eventId",f.eventId).attr("marketId",f.marketId).attr("betfairBetId",f.betfairBetId).attr("sideType",f.sideType).attr("status",f.status).attr("categoryType",
f.categoryType);t.find("#slipType").after('<span class="short-amount">'+f.selectionName+"</span>");null!=f.marketType&&"INNINGS_RUNS"==f.marketType?(t.find("#marketNameDt").addClass("slip-inline"),t.find("#marketName").html()):(t.find("#marketNameDt").removeClass("slip-inline"),t.find("#marketName").html(f.marketName));g(t);m.after(t.show())}else if(UnMatchTicketUtil.isDelete(f.status)||UnMatchTicketUtil.isLapsed(f.status)||1==f.summary||0==f.lastPrice){t.remove();break a}m.show();t.find("#price").html("").html(f.odds);
t.find("#size").html("").html(CurrencyUtil.formatter(f.lastPrice)).attr("title","$"+f.lastPrice);SideType.Back.unique()==q.value?t.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.profit)):t.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.liability));r?(t.find("#betId").html("").html("Ref:"+f.id),t.find("#placeDate").html("").html(f.createDateStr),t.find("#betInfo").show()):t.find("#betInfo").hide();null!=f.marketType&&"INNINGS_RUNS"==f.marketType?TxnHandler.appendInningRuns(t,
f):t.find("#inningsRuns").hide();if(!TxnHandler.userIsEditPersistence||p)r=$j("#editUnMatched_"+f.id),0!=r.length&&(CurrencyUtil.updateSetting({currencySymbol:""}),r.find("#odds").val(0).val(f.odds),r.find("#inputStake").val(0).val(MathUtil.roundp(f.lastPrice,2)).attr("title","$"+f.lastPrice),r.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex"),PersistenceType.Lapse.unique()==v?(r.find("#cancel").prop("checked",!0),r.find("#keep").prop("tabindex",-1)):PersistenceType.Persist.unique()==
v&&(r.find("#keep").prop("checked",!0),r.find("#cancel").prop("tabindex",-1)),m=CurrencyType.getInstanceOf(PageConfig.playerCurrency),CurrencyUtil.updateSetting({currencySymbol:m.symbol}),SideType.Back.unique()==q.value?r.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.profit)):r.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.liability)));UnMatchTicketUtil.isShowKeepCancel(f)?(t.find("#keepOption").show(),JsCache.get("#editAllBets").show()):t.find("#keepOption").hide();
t.find("#keepOptionBox").hide();t.find("[name=keepOption]").removeAttr("checked");PersistenceType.Lapse.unique()==v?(t.find("#cancel").attr("checked",!0),t.find("#editKeepOption").html("").html(I18N.get("form.text.inPlay.atInPlay.cancel"))):PersistenceType.Persist.unique()==v&&(t.find("#keep").attr("checked",!0),t.find("#editKeepOption").html("").html(I18N.get("form.text.inPlay.atInPlay.keep")));t.attr("persistenceType",v);q=$j("#unMatchTicketHead");v=$j("#unMatchFullBtn");UnMatchTicketUtil.isReady(f.status)?
(CategoryType.BETFAIR.unique()==f.categoryType?t.attr("class","slip-book"):t.attr("class","slip-"+SideType.Lay.name.toLowerCase()),t.find("#delete").hide(),q.find("#headerInfo").html("Pending"),v.find("#cancelAllUnMatch").hide(),v.find("#editAllBets").hide()):(t.find("#delete").show(),q.find("#headerInfo").html(I18N.get("form.text.unmatched")),v.find("#cancelAllUnMatch").show(),v.find("#editAllBets").show())}}}function H(){var a=!1,c=$j("[id^='unMatchTicket_']");$j.each(c,function(e,b){b=$j(b);if(b.attr("eventId")!=
A||b.attr("marketId")!=B||b.attr("categoryType")!=z||UnMatchTicketUtil.isDelete(b.attr("status"))||UnMatchTicketUtil.isLapsed(b.attr("status")))b.remove(),a=!0});return a}function g(a){a.find("#delete").click(function(){k(this)})}function l(){var a=TxnHandler.isShowBetInfo;DataBase.unMatchTicket.calculatePL();var c=DataBase.unMatchTicket.queryAll();d();for(var e=0;e<=c.length-1;e++){var b=c[e];if(b.eventId==A&&b.marketId==B&&b.categoryType==CategoryType.BETFAIR.unique())a:{var f=b,r=a,p=JsCache.get("#editUnMatchedList"),
m=SideType.getInstanceOf(f.sideType),t=f.persistenceType;b=SideType.Back.unique()==m.value?p.find("#backSlipHeader"):p.find("#laySlipHeader");var q=$j("#editUnMatched_"+f.id);if(0==q.length){if(UnMatchTicketUtil.isDelete(f.status)||UnMatchTicketUtil.isLapsed(f.status)||1==f.summary||0==f.lastPrice)break a;q=JsCache.clone("#editUnMatchedTemplate");q.attr("class","slip-"+m.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(m.name));q.attr("id","editUnMatched_"+f.id).attr("unMatchTicketId",
f.id).attr("eventType",f.eventType).attr("eventId",f.eventId).attr("marketId",f.marketId).attr("betfairBetId",f.betfairBetId).attr("sideType",f.sideType).attr("status",f.status).attr("categoryType",f.categoryType);q.find("#slipType").after('<span class="short-amount">'+f.selectionName+"</span>");null!=f.marketType&&"INNINGS_RUNS"==f.marketType?(q.find("#marketNameDt").addClass("slip-inline"),q.find("#marketName").html()):(q.find("#marketNameDt").removeClass("slip-inline"),q.find("#marketName").html(f.marketName));
h(q);CurrencyUtil.updateSetting({currencySymbol:""});q.find("#odds").val(0).val(f.odds);q.find("#inputStake").val(0).val(MathUtil.roundp(f.lastPrice,2)).attr("title","$"+f.lastPrice);q.find("#odds").prop("tabindex",0);q.find("#inputStake").prop("tabindex",0);q.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex");PersistenceType.Lapse.unique()==t?(q.find("#cancel").prop("checked",!0),q.find("#keep").prop("tabindex",-1)):PersistenceType.Persist.unique()==t&&(q.find("#keep").prop("checked",
!0),q.find("#cancel").prop("tabindex",-1));var v=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:v.symbol});SideType.Back.unique()==m.value?q.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.profit)):q.find("#profitLiability").html("").html(CurrencyUtil.formatter(f.liability));TxnHandler.getDynamicMinBet(q);b.after(q.show())}else if(UnMatchTicketUtil.isDelete(f.status)||UnMatchTicketUtil.isLapsed(f.status)||1==f.summary||0==f.lastPrice){q.remove();
break a}b.show();r?(q.find("#betId").html("").html("Ref:"+f.id),q.find("#placeDate").html("").html(f.createDateStr),q.find("#betInfo").show()):q.find("#betInfo").hide();null!=f.marketType&&"INNINGS_RUNS"==f.marketType?TxnHandler.appendInningRuns(q,f):q.find("#inningsRuns").hide();UnMatchTicketUtil.isShowKeepCancel(f)?q.find("#keepOptionBox").show():q.find("#keepOptionBox").hide();q.attr("persistenceType",t);CoinHandler.clickStakePopupList(q,p,!0)}}}function d(){var a=!1,c=$j("[id^='editUnMatched_']");
$j.each(c,function(e,b){b=$j(b);if(b.attr("eventId")!=A||b.attr("marketId")!=B||b.attr("categoryType")!=z||UnMatchTicketUtil.isDelete(b.attr("status"))||UnMatchTicketUtil.isLapsed(b.attr("status")))b.remove(),a=!0});return a}function h(a){let c=null,e=null,b=null,f=null,r=null,p=null;a.find("#delete").click(function(){k(this)});a.find("#odds").change(function(){TxnHandler.commonEvent(a);TxnHandler.getDynamicMinBet(a)});a.find("#inputStake").change(function(){TxnHandler.commonEvent(a)});a.find("#oddsUp").click(function(){a.find("ul").hasClass("disable")||
(BetHandler.clickOdds(a.attr("eventId"),a.attr("marketId"),a.attr("selectionKey"),a.attr("sideType"),this,a),TxnHandler.commonEvent(a),TxnHandler.getDynamicMinBet(a),1E3<a.find("#odds").val()&&(a.find("#odds").val(1E3),TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds"))))});a.find("#oddsDown").click(function(){a.find("ul").hasClass("disable")||(BetHandler.clickOdds(a.attr("eventId"),a.attr("marketId"),a.attr("selectionKey"),a.attr("sideType"),this,a),TxnHandler.commonEvent(a),
TxnHandler.getDynamicMinBet(a))});PageConfig.TEMP_CTRL_ENABLE_DESKTOP_BETBOARD_KEYDOWN&&(a.find("#oddsUp").mousedown(function(m){null===e&&(e=setTimeout(function(){e=null;null===c&&(c=setInterval(function(){a.find("#oddsUp").click()},50))},1E3))}),a.find("#oddsDown").mousedown(function(m){null===f&&(f=setTimeout(function(){f=null;null===b&&(b=setInterval(function(){a.find("#oddsDown").click()},50))},1E3))}),a.find("#odds").keydown(function(m){m=m.which;KeyEventUtils.isUpArrowKey(m)&&null===p&&(p=
setTimeout(function(){p=null;null===r&&(r=setInterval(function(){a.find("#oddsUp").click()},50))},1E3));KeyEventUtils.isDownArrowKey(m)&&null===p&&(p=setTimeout(function(){p=null;null===r&&(r=setInterval(function(){a.find("#oddsDown").click()},50))},1E3))}));a.find("#oddsUp").mouseup(function(m){clearInterval(c);clearTimeout(e);e=c=null});a.find("#oddsUp").mouseout(function(m){clearInterval(c);clearTimeout(e);e=c=null});a.find("#oddsDown").mouseup(function(m){clearInterval(b);clearTimeout(f);f=b=
null});a.find("#oddsDown").mouseout(function(m){clearInterval(b);clearTimeout(f);f=b=null});a.find("#odds").blur(function(){r&&(clearInterval(r),r=null);p&&(clearTimeout(p),p=null);BetHandler.blurCheckOddsValidate(this,JsCache.get("#editBetMsg"),a.attr("eventId"),a.attr("marketId").replace("_","."));TxnHandler.commonEvent(a);TxnHandler.getDynamicMinBet(a);1E3<$j(this).val()&&(a.find("#odds").val(1E3),TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds")))});a.find("#odds").keyup(function(m){var t=
$j(this);TxnHandler.validComma(t);outOfScale(t.val(),2)&&t.val(MathUtil.floorp(t.val(),2));TxnHandler.commonEvent(a);TxnHandler.getDynamicMinBet(a);m=m.which;KeyEventUtils.isEnterKey(m)&&$j("#okBtn").click();KeyEventUtils.isTabKey(m)&&a.find("#odds").is(":focus")&&a.find("#odds").select();if(KeyEventUtils.isUpArrowKey(m)||KeyEventUtils.isDownArrowKey(m))r&&(clearInterval(r),r=null),p&&(clearTimeout(p),p=null),a.find("ul").hasClass("disable")||(BetHandler.clickUpDownArrowKey(a.attr("eventId"),a.attr("marketId"),
a.attr("selectionKey"),a.attr("sideType"),m,a),TxnHandler.commonEvent(a),TxnHandler.getDynamicMinBet(a),KeyEventUtils.isUpArrowKey(m)&&1E3<a.find("#odds").val()&&(a.find("#odds").val(1E3),TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds"))))});a.find("#odds").click(function(){a.find("#odds").select()});a.find("#inputStake").click(function(){a.find("#inputStake").select()});a.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();var m=BetHandler.isAllowNonIntegerStake(PageConfig.playerCurrency);
isNaN(a.find("#inputStake").val())&&m&&(m=BetHandler.getMinBet(a.attr("eventId"),a.attr("marketId"),a.attr("eventType"),parseFloat(a.find("#odds").val())),$j(this).val(m));TxnHandler.validComma($j(this));BetHandler.blurCheckStakeValid($j(this),PageConfig.webSiteType,PageConfig.playerCurrency,parseFloat(a.find("#inputStake").val()),JsCache.get("#editBetMsg"),a.attr("eventId"),a.attr("marketId").replace("_","."),a.attr("eventType"),parseFloat(a.find("#odds").val())||0);TxnHandler.commonEvent(a);MathUtil.isNumeric($j(this).val(),
!0,!1)||$j(this).val("")});a.find("#inputStake").keydown(function(m){var t=BetHandler.isAllowNonIntegerStake(PageConfig.playerCurrency),q=m.which;KeyEventUtils.isNumberKey(m)||KeyEventUtils.isBackspaceKey(q)||KeyEventUtils.isDeleteKey(q)||KeyEventUtils.isArrowKey(q)||KeyEventUtils.isTabKey(q)||KeyEventUtils.isEnterKey(q)||t&&KeyEventUtils.isDecimalPointKey(q)||WindowEventUtil.stopEvent(m)});a.find("#inputStake").keyup(function(m){var t=$j(this),q=$j(this).parents("[id^=editUnMatched_]").attr("unmatchticketid"),
v=BetHandler.isAllowNonIntegerStake(PageConfig.playerCurrency);let G=v?1:2;q=DataBase.unMatchTicket.get(q);$j(this).val()!=q.lastPrice&&(v?outOfScale(t.val(),G)&&t.val(MathUtil.floorp(t.val(),G)):$j(this).val(function(I,J){return commaSeparateNumber(J)}));TxnHandler.validComma(t);(isNaN(t.val())||1>t.val())&&t.val("");outOfScale(t.val(),G)&&t.val(MathUtil.floorp(t.val(),G));TxnHandler.commonEvent(a);m=m.which;KeyEventUtils.isEnterKey(m)&&(t=a.find("#inputStake").val(),a.find("#inputStake").blur(),
t==a.find("#inputStake").val()&&$j("#okBtn").click());KeyEventUtils.isTabKey(m)&&a.find("#inputStake").is(":focus")&&a.find("#inputStake").select()});a.find("#cancel").click(function(){TxnHandler.selectKeepOption(a,PersistenceType.Lapse.unique());TxnHandler.disableOtherInput(a);0==TxnHandler.checkDataIsEdited(a)&&TxnHandler.enableInput(a)});a.find("#keep").click(function(){TxnHandler.selectKeepOption(a,PersistenceType.Persist.unique());TxnHandler.disableOtherInput(a);0==TxnHandler.checkDataIsEdited(a)&&
TxnHandler.enableInput(a)})}function k(a){var c=$j(a).parent().parent();a=c.attr("eventId");var e=c.attr("marketId");c=c.attr("unMatchTicketId");w([{eventId:a,marketId:e,unMatchTicketId:c}])}function w(a){TxnHandler.clickResetBtn();0!=a.length&&$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/cancelUnMatchTicket",data:{cancelUnMatchTickets:JSON.stringify(a)},beforeSend:function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide()},success:function(c){try{if(0!=
c.result.length){for(var e in c.result){var b=c.result[e];null!=b.unMatchTicket&&DataBase.unMatchTicket.update([b.unMatchTicket]);null!=b.totalCancelPrice?BetHandler.fadeInMsg("#betMsg",I18N.get("msg.member.betting.cancelUnMatchTicketSuccess",[CurrencyUtil.formatter(b.totalCancelPrice)])):null!=b.error&&BetHandler.fadeInMsg("#errorMsg",b.error)}TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets()}}catch(f){Trace.printStackTrace(f)}finally{TxnHandler.unTask.reset(),
TxnHandler.unTask.refresh(),setTimeout(function(){JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show()},1E3)}},error:function(c){Trace.printStackTrace(c);JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show()}})}function n(){var a=TxnHandler.isShowBetInfo,c=TxnHandler.isShowAverageOdds,e=TxnHandler.isShowConsolidate;CategoryType.BOOK_MAKER.unique()==z?DataBase.bookMakerTxn.calculatePL():(DataBase.txn.calculatePL(),DataBase.sportsBookTxn.calculatePL(),DataBase.fancyBetTxn.calculatePL(),
DataBase.financialTxn.calculatePL());var b=TxnHandler.getMarketTxnByCategoryType(A,B,null,null,z);if(c){$j("[id^='txn_']").remove();var f=new HashMap,r=new HashMap;for(a=0;a<=b.length-1;a++)if(c=b[a],!MyTransactionUtils.isSettle(c.status)){e=f;var p=e.get,m=D(c.selectionId,c.selectionKey);e=p.call(e,c.sideType+"_"+m);null==e&&(e=[]);e.push(c);p=f;m=p.put;var t=D(c.selectionId,c.selectionKey);m.call(p,c.sideType+"_"+t,e)}b=f.keySet();for(var q in b){a=b[q];e=m=c=0;p={};t=f.get(a);for(var v in t){p=
t[v];c=MathUtil.decimal.add(c,parseFloat(p.stake));m=MathUtil.decimal.add(m,parseFloat(p.stakeOdds));var G=p.transactionDate;e=e>G?e:G}m=MathUtil.decimal.divide(m,c);m=MathUtil.roundp(m,2);t=MathUtil.decimal.multiply(MathUtil.decimal.subtract(m,1),c);p.averageOdds=m;p.totalStake=c;p.totalProfit=t;p.maxTransactionDate=e;r.put(a,p)}b=M(r);TxnHandler.isShowTimeOrder&&b.sort(N);for(q=0;q<=b.length-1;q++)v=b[q],u(v,!1,v.averageOdds,v.totalStake,v.totalProfit)}else if(e){$j("[id^='txn_']").remove();q=new HashMap;
v=new HashMap;for(a=0;a<=b.length-1;a++)c=b[a],MyTransactionUtils.isSettle(c.status)||(e=q,p=e.get,m=D(c.selectionId,c.selectionKey),e=p.call(e,c.sideType+"_"+m+"_"+c.odds),null==e&&(e=[]),e.push(c),p=q,m=p.put,t=D(c.selectionId,c.selectionKey),m.call(p,c.sideType+"_"+t+"_"+c.odds,e));b=q.keySet();for(f in b){a=b[f];e=c=0;p={};m=q.get(a);for(r in m)p=m[r],c=MathUtil.decimal.add(c,parseFloat(p.stake)),t=p.transactionDate,e=e>t?e:t;m=MathUtil.decimal.multiply(MathUtil.decimal.subtract(p.odds,1),c);
p.averageOdds=p.odds;p.totalStake=c;p.totalProfit=m;p.maxTransactionDate=e;v.put(a,p)}b=M(v);TxnHandler.isShowTimeOrder&&b.sort(N);for(q=0;q<=b.length-1;q++)v=b[q],u(v,!1,v.averageOdds,v.totalStake,v.totalProfit)}else for($j("[id^='txn_']").remove(),TxnHandler.isShowTimeOrder&&b.sort(Q),q=0;q<=b.length-1;q++)v=b[q],MyTransactionUtils.isSettle(v.status)||u(v,a)}function u(a,c,e,b,f){if(1!=a.summary){var r=CategoryType.BETFAIR.unique();a.categoryType&&(r=a.categoryType);var p=CurrencyType.getInstanceOf(PageConfig.playerCurrency);
CurrencyUtil.updateSetting({currencySymbol:p.symbol});if(CategoryType.BETFAIR.unique()==r){p=JsCache.get("#txnList");r=SideType.getInstanceOf(a.sideType);p=TxnHandler.isShowTimeOrder?p.find("#backLaySlipHeader").show():SideType.Back.unique()==r.value?p.find("#backSlipHeader").show():p.find("#laySlipHeader").show();var m=JsCache.clone("#txnTemplate");m.attr("class","slip-"+r.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(r.name));m.attr("id","txn_"+a.id).attr("betfairBetId",a.betfairBetId).attr("sideType",
a.sideType);m.find("#slipPredict").prepend('<span class="short-amount">'+a.selectionName+"</span>");null!=a.marketType&&"INNINGS_RUNS"==a.marketType?(m.find("dt").addClass("slip-inline"),m.find("#marketName").html("")):(m.find("dt").removeClass("slip-inline"),m.find("#marketName").html(a.marketName));m.find("#price").html(null==e?a.odds:MathUtil.roundp(e,2));m.find("#size").html(null==b?CurrencyUtil.formatter(a.stake):CurrencyUtil.formatter(b)).attr("title",null==b?"$"+a.stake:"$"+b);null==f?SideType.Back.unique()==
r.value?m.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)):m.find("#profitLiability").html(CurrencyUtil.formatter(a.liability)):m.find("#profitLiability").html(CurrencyUtil.formatter(a.totalProfit));c?(m.find("#betId").html(null==a.betId?"Ref: 0":"Ref: "+a.betId),m.find("#placeDate").html(a.transactionDateStr),m.find("#betInfo").show()):m.find("#betInfo").hide();p.after(m.show())}else CategoryType.FANCY_BET.unique()==r?(e=FancyBetMarketType.getInstanceByName(a.marketType),null!=e&&
(b=CurrencyType.getInstanceOf(PageConfig.playerCurrency),CurrencyUtil.updateSetting({currencySymbol:b.symbol}),f=$j("#txnList"),TxnHandler.isShowTimeOrder?b=f.find("#fancyYesNoHeader").show():FancySideType.YES.unique()==a.sideType?(b=f.find("#fancyYesHeader").show(),FancyBetMarketType.LOTTERY.unique()==e.unique()||FancyBetMarketType.KHADDA.unique()==e.unique()?b.find("#colBet").html(""):b.find("#colBet").html(StringUtil.ucfirst(FancySideType.YES.name))):b=f.find("#fancyNoHeader").show(),EventType.ELECTION.unique()==
a.eventType?b.find("#runsOdds").html("Seats/Odds"):FancyBetMarketType.LOTTERY.unique()==e.unique()||FancyBetMarketType.KHADDA.unique()==e.unique()?b.find("#runsOdds").html("Runs"):b.find("#runsOdds").html("Runs/Odds"),f.find("#backSlipHeader").hide(),f.find("#laySlipHeader").hide(),e=f.find("#txnTemplate").clone(),e.removeAttr("style"),e.prop("class","slip-"+SideType.getInstanceOf(a.sideType).name.toLowerCase()),e.prop("id","txn_"+a.id),e.prop("sideType",a.sideType),e.prop("title","$"+a.stake),e.find("#slipType").html(StringUtil.ucfirst(FancySideType.getInstanceOf(a.sideType).name)),
e.find("#slipPredict").prepend('<span class="short-amount">'+a.marketName+"</span>"),e.find("#marketName").html(""),e.find("#price").html(a.runs+"/"+a.odds),e.find("#size").html(CurrencyUtil.formatter(a.stake)),FancySideType.YES.unique()==a.sideType?e.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)):e.find("#profitLiability").html(CurrencyUtil.formatter(a.liability)),c?(e.find("#betId").html(null==a.id?"Ref: 0":"Ref: "+a.id),e.find("#placeDate").html(a.transactionDateStr),e.find("#betInfo").show()):
e.find("#betInfo").hide(),b.after(e))):CategoryType.OW_SPORTSBOOK.unique()==r?(e=CurrencyType.getInstanceOf(PageConfig.playerCurrency),CurrencyUtil.updateSetting({currencySymbol:e.symbol}),b=$j("#txnList"),e=b.find("#backSlipHeader").show(),b=b.find("#txnTemplate").clone(),b.removeAttr("style"),b.prop("class","slip-"+SideType.Back.name.toLowerCase()),b.prop("id","txn_"+a.id),b.prop("betfairBetId",a.betfairBetId),b.prop("sideType",a.sideType),b.prop("title","$"+a.stake),b.find("#slipType").html(StringUtil.ucfirst(SideType.Back.name)),
b.find("#slipPredict").prepend('<span class="short-amount">'+a.selectionName+"</span>"),b.find("dt").removeClass("slip-inline"),b.find("#marketName").html(a.marketName),b.find("#price").html(a.odds),b.find("#size").html(CurrencyUtil.formatter(a.stake)),b.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)),c?(b.find("#betId").html(null==a.betId?"Ref: 0":"Ref: "+a.betId),b.find("#placeDate").html(a.transactionDateStr),b.find("#betInfo").show()):b.find("#betInfo").hide(),e.after(b)):CategoryType.SPORTRADAR_SPORTSBOOK.unique()==
r?(e=CurrencyType.getInstanceOf(PageConfig.playerCurrency),CurrencyUtil.updateSetting({currencySymbol:e.symbol}),b=$j("#txnList"),e=b.find("#backSlipHeader").show(),b=b.find("#txnTemplate").clone(),b.removeAttr("style"),b.prop("class","slip-"+SideType.Back.name.toLowerCase()),b.prop("id","txn_"+a.id),b.prop("betfairBetId",a.betfairBetId),b.prop("sideType",a.sideType),b.prop("title","$"+a.stake),b.find("#slipType").html(StringUtil.ucfirst(SideType.Back.name)),b.find("#slipPredict").prepend('<span class="short-amount">'+
a.selectionName+"</span>"),b.find("dt").removeClass("slip-inline"),b.find("#marketName").html(a.marketName),b.find("#price").html(a.odds),b.find("#size").html(CurrencyUtil.formatter(a.stake)),b.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)),c?(b.find("#betId").html(null==a.betId?"Ref: 0":"Ref: "+a.betId),b.find("#placeDate").html(a.transactionDateStr),b.find("#betInfo").show()):b.find("#betInfo").hide(),e.after(b)):CategoryType.BOOK_MAKER.unique()==r?(e=CurrencyType.getInstanceOf(PageConfig.playerCurrency),
CurrencyUtil.updateSetting({currencySymbol:e.symbol}),b=$j("#txnList"),e=TxnHandler.isShowTimeOrder?b.find("#backLaySlipHeader").show():b.find("#"+SideType.getInstanceOf(a.sideType).name.toLowerCase()+"SlipHeader").show(),e.find("#runsOdds").html("Odds"),b=b.find("#txnTemplate").clone(),b.removeAttr("style"),b.prop("class","slip-"+SideType.getInstanceOf(a.sideType).name.toLowerCase()),b.prop("id","txn_"+a.id),b.prop("sideType",a.sideType),b.prop("title","$"+a.stake),b.find("#slipType").html(StringUtil.ucfirst(SideType.getInstanceOf(a.sideType).name)),
b.find("#slipPredict").prepend('<span class="short-amount">'+a.selectionName+"</span>"),b.find("#marketName").html(""),b.find("#price").html(a.odds),b.find("#size").html(CurrencyUtil.formatter(a.stake)),SideType.Back.unique()==a.sideType?b.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)):b.find("#profitLiability").html(CurrencyUtil.formatter(a.liability)),c?(b.find("#betId").html(null==a.id?"Ref: 0":"Ref: "+a.id),b.find("#placeDate").html(a.transactionDateStr),b.find("#betInfo").show()):
b.find("#betInfo").hide(),e.after(b)):CategoryType.TS_BINARY.unique()==r&&(e=CurrencyType.getInstanceOf(PageConfig.playerCurrency),CurrencyUtil.updateSetting({currencySymbol:e.symbol}),b=$j("#txnList"),e=TxnHandler.isShowTimeOrder?b.find("#fancyYesNoHeader"):b.find("#fancy"+StringUtil.ucfirst(FancySideType.getInstanceOf(a.sideType).name)+"Header"),e.show(),e.find("#runsOdds").html("Price / Odds"),b.find("#backSlipHeader").hide(),b.find("#laySlipHeader").hide(),b=b.find("#txnTemplate").clone(),b.removeAttr("style"),
b.prop("class","slip-"+SideType.getInstanceOf(a.sideType).name.toLowerCase()),b.prop("id","txn_"+a.id),b.prop("sideType",a.sideType),b.prop("title","$"+a.stake),b.find("#slipType").html(StringUtil.ucfirst(FancySideType.getInstanceOf(a.sideType).name)),b.find("#slipPredict").prepend('<span class="short-amount">'+a.marketName+"</span>"),b.find("#marketName").html(""),b.find("#price").html(a.price+" / "+a.odds),b.find("#size").html(CurrencyUtil.formatter(a.stake)),SideType.Back.unique()==a.sideType?
b.find("#profitLiability").html(CurrencyUtil.formatter(a.profit)):b.find("#profitLiability").html(CurrencyUtil.formatter(a.liability)),c?(b.find("#betId").html(null==a.id?"Ref: 0":"Ref: "+a.id),b.find("#placeDate").html(a.transactionDateStr),b.find("#betInfo").show()):b.find("#betInfo").hide(),e.after(b))}}function R(a){0==TxnHandler.marketPks.length?(a.check(),TaskExecuter.execute()):$j.ajax({type:"POST",dataType:"JSON",url:(PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost?
QueryDataSubDomainUtil.queryHost:"")+"/member/playerService/queryRemovedMarkets",data:{marketPks:TxnHandler.marketPks,queryPass:PageConfig.queryPass},xhrFields:{withCredentials:!0},success:function(c){try{if(0!=c.marketPks.length){var e=!1,b;for(b in c.marketPks){var f=c.marketPks[b];1==f.inPlay&&(DataBase.unMatchTicket.marketChangeToInPlay(f),DataBase.sportsBookUnMatchTicket.marketChangeToInPlay(f));1==f.removed&&(DataBase.unMatchTicket.summaryByMarketPk(f),DataBase.txn.summaryByMarketPk(f),DataBase.sportsBookUnMatchTicket.summaryByMarketPk(f),
DataBase.sportsBookTxn.summaryByMarketPk(f),DataBase.bookMakerTxn.summaryByMarketPk(f),DataBase.financialTxn.summaryByMarketPk(f),DataBase.fancyBetTxn.summaryByMarketPk(f),S(f.eventId+";"+f.marketId),e=!0)}e&&(TxnHandler.refreshOpenBets(),TxnHandler.updateOpenBetSelectionBox(),TxnHandler.checkToHideOpenBets())}}catch(r){Trace.printStackTrace(r)}finally{a.check(),TaskExecuter.execute()}},error:function(){PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost&&!QueryDataSubDomainUtil.isLineDown&&
(QueryDataSubDomainUtil.queryHost=null,QueryDataSubDomainUtil.isLineDown=!0);a.check();TaskExecuter.execute()}})}function S(a){TxnHandler.marketPks=$j.grep(TxnHandler.marketPks,function(c){return c!=a})}function O(a){var c=$j("#openBetSlip");null!=a&&a&&CategoryType.BETFAIR.unique()==a?c.find("[name=txnOption]").show():(TxnHandler.isShowConsolidate=!1,TxnHandler.isShowAverageOdds=!1,c.find("#consolidate").prop("checked",!1),c.find("#averageOdds").prop("checked",!1),c.find("[name=txnOption]").hide());
null==a||!a||CategoryType.BETFAIR.unique()!=a&&CategoryType.BOOK_MAKER.unique()!=a&&CategoryType.FANCY_BET.unique()!=a&&CategoryType.TS_BINARY.unique()!=a?(TxnHandler.isShowTimeOrder=!1,c.find("#showTimeOrder").prop("checked",!1),c.find("[name=showTimeOption]").hide()):c.find("[name=showTimeOption]").show()}function Q(a,c){return a.transactionDate-c.transactionDate}function N(a,c){return a.maxTransactionDate-c.maxTransactionDate}function M(a){var c=[],e=a.keySet(),b;for(b in e)c.push(a.get(e[b]));
return c}TxnHandler.unTask;var A=0,B="",z="";TxnHandler.isShowBetInfo=!1;TxnHandler.isShowAverageOdds=!1;TxnHandler.isShowConsolidate=!1;TxnHandler.isShowTimeOrder=!1;var P=!0;TxnHandler.marketPks=[];var L=TxnHandler.userIsEditPersistence=!1;TxnHandler.init=function(){UiUtils.bindToExpand($j(".slip-wrap .to-expand"),function(){$j(".matched-wrap").css("height","calc(100% - 301px)")},function(){$j(".matched-wrap").css("height","calc(100% - 26px)")});UiUtils.bindToExpand($j(".matched-wrap .to-expand"),
BetHandler.openCallBack,BetHandler.closeCallBack);$j(".main_wrap > ul > li > a").removeClass("select");TxnHandler.checkOpenOptionFromCookie();JsCache.get("#selectMenu").change(function(){TxnHandler.getEventIdAndMarketId(this);O(z);TxnHandler.refreshOpenBets();TxnHandler.userIsEditPersistence=!1});JsCache.get("#openBetsRefresh").click(function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide();TxnHandler.unTask.reset();TxnHandler.unTask.refresh();setTimeout(function(){JsCache.get("#processingImg").hide();
JsCache.get("#matchSection").show()},1E3)});JsCache.get("#showBetInfo").click(function(){1==TxnHandler.isShowBetInfo?(TxnHandler.isShowBetInfo=!1,TxnHandler.addOpenOptionToCookie(0)):(TxnHandler.isShowBetInfo=!0,TxnHandler.addOpenOptionToCookie(1));TxnHandler.isShowAverageOdds=!1;TxnHandler.isShowConsolidate=!1;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});JsCache.get("#consolidate").click(function(){1==TxnHandler.isShowConsolidate?(TxnHandler.isShowConsolidate=!1,TxnHandler.addOpenOptionToCookie(0)):
(TxnHandler.isShowConsolidate=!0,TxnHandler.addOpenOptionToCookie(2));TxnHandler.isShowBetInfo=!1;TxnHandler.isShowAverageOdds=!1;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});JsCache.get("#averageOdds").click(function(){1==TxnHandler.isShowAverageOdds?(TxnHandler.isShowAverageOdds=!1,TxnHandler.addOpenOptionToCookie(0)):(TxnHandler.isShowAverageOdds=!0,TxnHandler.addOpenOptionToCookie(3));TxnHandler.isShowBetInfo=!1;TxnHandler.isShowConsolidate=!1;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});
JsCache.get("#showTimeOrder").click(function(){TxnHandler.isShowTimeOrder=TxnHandler.isShowTimeOrder?!1:!0;TxnHandler.addOpenOptionTimeOrderToCookie();TxnHandler.refreshOpenBets()});JsCache.get("#okBtn").click(function(){TxnHandler.updateUnMatchTicketList()});JsCache.get("#okBtn").keydown(function(a){KeyEventUtils.isEnterKey(a.which)&&JsCache.get("#okBtn").click()});JsCache.get("#editAllBets").click(function(){TxnHandler.userIsEditPersistence=!0;TxnHandler.clickEditBetBtn()});JsCache.get("#editAllBets").keyup(function(a){KeyEventUtils.isEnterKey(a.which)&&
JsCache.get("#editAllBets").click()});JsCache.get("#resetBtn").click(function(){TxnHandler.clickResetBtn()});JsCache.get("#resetBtn").keyup(function(a){KeyEventUtils.isEnterKey(a.which)&&JsCache.get("#resetBtn").click()});JsCache.get("[id^=cancelAllUnMatch]").click(function(){TxnHandler.cancelAllUnMatchTickets(this)});JsCache.get("[id^=cancelAllUnMatch]").keydown(function(a){KeyEventUtils.isEnterKey(a.which)&&TxnHandler.cancelAllUnMatchTickets(this)});JsCache.get("#openBetSlip").scroll(function(){CoinHandler.hideStakePopupList();
for(var a=$j("[id^=editUnMatched_]"),c=0;c<a.length;c++){var e=$j(a[c]);BetHandler.hideStakeTipsPopup(e);BetHandler.hideOddsTips(e)}});TxnHandler.userIsEditPersistence=!1;TxnHandler.checkToHideOpenBets();L=!0};TxnHandler.getEventIdAndMarketId=function(a){a=$j("#openBetSelectionBox").find("select :selected");A=parseInt(a.attr("eventId"));B=a.attr("marketId");z=parseInt(a.attr("categorytype"))};TxnHandler.setEventIdAndMarketId=function(a,c,e){A=a;B=c.replace("_",".");z=e};TxnHandler.getBettingMarketIdFromEventId=
function(a){var c=DataBase.unMatchTicket.getByEventId(a,CategoryType.BETFAIR.unique());a=DataBase.txn.getByEventId(a,CategoryType.BETFAIR.unique());if(0==c.length&&0==a.length)return null;if(0<c.length)return c[0].marketId;if(0<a.length)return a[0].marketId};TxnHandler.changeOpenBetInFullMarkets=function(a,c){var e=DataBase.unMatchTicket.getByMarketId(a,c,null,CategoryType.BETFAIR.unique()),b=DataBase.txn.getByMarketId(a,c,null,null,CategoryType.BETFAIR.unique());if(0<e.length||0<b.length)TxnHandler.setEventIdAndMarketId(a,
c,CategoryType.BETFAIR.unique()),TxnHandler.updateOpenBetSelectionBox(),TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId),TxnHandler.refreshOpenBets()};TxnHandler.addBlankSelectOption=function(a,c){if(-1==a&&null==c)TxnHandler.removeBlankSelectOption();else{var e=$j("#openBetSelectionBox"),b=!0,f=!0;if(null==c)b=null==TxnHandler.getBettingMarketIdFromEventId(a)?!0:!1;else{var r=DataBase.unMatchTicket.getByMarketId(a,c,null,CategoryType.BETFAIR.unique());a=DataBase.txn.getByMarketId(a,
c,null,null,CategoryType.BETFAIR.unique());if(0<r.length||0<a.length)f=!1}b&&f?(e.find("option:selected").prop("selected",!1),0==e.find("#option0").length&&(b=JsCache.clone("#optionTemplate"),b.attr("id","option0"),b.attr("eventType",0).attr("eventId",0).attr("marketId",0),b.html(" -- "+I18N.get("form.text.bet.select")+" -- "),b.attr("date",-1),b.prop("selected","selected"),e.find("#selectMenu").append(b.show())),TxnHandler.refreshOpenBets()):PageConfig.isPoliticsPage||TxnHandler.removeBlankSelectOption()}};
TxnHandler.removeBlankSelectOption=function(){var a=$j("#openBetSelectionBox");0!=a.find("#option0").length&&a.find("#option0").remove();null!=PageConfig.selectEventId&&null!=PageConfig.selectMarketId?TxnHandler.setEventIdAndMarketId(PageConfig.selectEventId,PageConfig.selectMarketId,CategoryType.BETFAIR.unique()):null!=PageConfig.selectEventId&&null==PageConfig.selectMarketId&&(a=TxnHandler.getBettingMarketIdFromEventId(PageConfig.selectEventId),null!=a&&TxnHandler.setEventIdAndMarketId(PageConfig.selectEventId,
a,CategoryType.BETFAIR.unique()));TxnHandler.updateOpenBetSelectionBox()};TxnHandler.refreshOpenBets=function(){if(TxnHandler.userIsEditPersistence){l();var a=JsCache.get("#editUnMatchedList");var c=JsCache.get("#editUnMatchFullBtn")}else E(),a=JsCache.get("#unMatchTicketList"),c=JsCache.get("#unMatchFullBtn");n();var e=TxnHandler.getUnMatchTicketByCategoryType(A,B,null,z),b=TxnHandler.getMarketTxnByCategoryType(A,B,null,null,z),f=TxnHandler.getUnMatchTicketByCategoryType(A,B,SideType.Back.unique(),
z),r=TxnHandler.getUnMatchTicketByCategoryType(A,B,SideType.Lay.unique(),z),p=TxnHandler.getMarketTxnByCategoryType(A,B,SideType.Back.unique(),null,z),m=TxnHandler.getMarketTxnByCategoryType(A,B,SideType.Lay.unique(),null,z);0==e.length?(JsCache.get("#unMatchTicketHead").hide(),JsCache.get("#unMatchTicketList").hide(),JsCache.get("#unMatchFullBtn").hide(),JsCache.get("#editUnMatchedList").hide(),JsCache.get("#editUnMatchFullBtn").hide()):(JsCache.get("#unMatchTicketHead").show(),a.show(),c.show());
0==f.length?(JsCache.get("#editUnMatchedList").find("#backSlipHeader").hide(),JsCache.get("#unMatchTicketList").find("#backSlipHeader").hide()):a.find("#backSlipHeader").show();0==r.length?(JsCache.get("#editUnMatchedList").find("#laySlipHeader").hide(),JsCache.get("#unMatchTicketList").find("#laySlipHeader").hide()):a.find("#laySlipHeader").show();$j("#openBetSlip");0==b.length?(JsCache.get("#txnHead").hide(),JsCache.get("#txnList").hide()):(JsCache.get("#txnHead").show(),JsCache.get("#txnList").show(),
O(b[0].categoryType));0==p.length?(JsCache.get("#txnList").find("#backSlipHeader").hide(),JsCache.get("#txnList").find("#fancyYesHeader").hide()):null==p[0]||!p[0].categoryType||CategoryType.FANCY_BET.unique()!=p[0].categoryType&&CategoryType.TS_BINARY.unique()!=p[0].categoryType?(JsCache.get("#txnList").find("#backSlipHeader").show(),JsCache.get("#txnList").find("#fancyYesHeader").hide()):(JsCache.get("#txnList").find("#backSlipHeader").hide(),JsCache.get("#txnList").find("#fancyYesHeader").show());
0==m.length?(JsCache.get("#txnList").find("#laySlipHeader").hide(),JsCache.get("#txnList").find("#fancyNoHeader").hide()):null==m[0]||!m[0].categoryType||CategoryType.FANCY_BET.unique()!=m[0].categoryType&&CategoryType.TS_BINARY.unique()!=m[0].categoryType?(JsCache.get("#txnList").find("#laySlipHeader").show(),JsCache.get("#txnList").find("#fancyNoHeader").hide()):(JsCache.get("#txnList").find("#laySlipHeader").hide(),JsCache.get("#txnList").find("#fancyNoHeader").show());1==$j("#openBetSelectionBox").find("#option0").prop("selected")?
JsCache.get("#openBetSlip").hide():JsCache.get("#openBetSlip").show();JsCache.get("#txnList").find("#fancyYesNoHeader").hide();JsCache.get("#txnList").find("#backLaySlipHeader").hide();if(TxnHandler.isShowTimeOrder)if(CategoryType.BETFAIR.unique()==z||CategoryType.BOOK_MAKER.unique()==z)JsCache.get("#txnList").find("#backSlipHeader").hide(),JsCache.get("#txnList").find("#laySlipHeader").hide(),JsCache.get("#txnList").find("#backLaySlipHeader").show();else if(CategoryType.FANCY_BET.unique()==z||CategoryType.TS_BINARY.unique()==
z)JsCache.get("#txnList").find("#fancyYesHeader").hide(),JsCache.get("#txnList").find("#fancyNoHeader").hide(),JsCache.get("#txnList").find("#fancyYesNoHeader").show()};TxnHandler.clickOpenOption=function(){var a=JsCache.get("#showBetInfo"),c=JsCache.get("#averageOdds"),e=JsCache.get("#consolidate"),b=JsCache.get("#showTimeOrder");JsCache.get("[name^=openOption]").removeAttr("checked");JsCache.get("#showTimeOrder").removeAttr("checked");1==TxnHandler.isShowTimeOrder&&b.prop("checked",!0);1==TxnHandler.isShowBetInfo?
a.prop("checked",!0):1==TxnHandler.isShowAverageOdds?c.prop("checked",!0):1==TxnHandler.isShowConsolidate&&e.prop("checked",!0)};TxnHandler.checkOpenOptionFromCookie=function(){var a=CookieUtil.getCookie("openOption_"+PageConfig.userID),c=CookieUtil.getCookie("openOptionTimeOrder_"+PageConfig.userID);TxnHandler.isShowBetInfo=!1;TxnHandler.isShowAverageOdds=!1;TxnHandler.isShowConsolidate=!1;TxnHandler.isShowTimeOrder=!1;1==a?TxnHandler.isShowBetInfo=!0:2==a?TxnHandler.isShowConsolidate=!0:3==a&&(TxnHandler.isShowAverageOdds=
!0);TxnHandler.isShowTimeOrder=1==c?!0:!1;TxnHandler.clickOpenOption()};TxnHandler.addOpenOptionToCookie=function(a){CookieUtil.setCookie("openOption_"+PageConfig.userID,a,999)};TxnHandler.addOpenOptionTimeOrderToCookie=function(){CookieUtil.setCookie("openOptionTimeOrder_"+PageConfig.userID,1==TxnHandler.isShowTimeOrder?1:0,999)};TxnHandler.updateOpenBetSelectionBox=function(){$j("[id^='option_']").remove();y(DataBase.txn.queryAll(),"txn");y(DataBase.unMatchTicket.queryAll(),"unMatchTicket");y(DataBase.sportsBookTxn.queryAll(),
"sportsBookTxn");y(DataBase.sportsBookUnMatchTicket.queryAll(),"sportsBookUnMatchTicket");y(DataBase.fancyBetTxn.queryAll(),"fancyBetTxn");y(DataBase.bookMakerTxn.queryAll(),"bookMakerTxn");y(DataBase.financialTxn.queryAll(),"financialTxn");var a=!1;isNaN(A)||void 0==B||0==$j("#option_"+x(A,B,z)).length&&(a=!0);if(1==P||1==a)TxnHandler.getEventIdAndMarketId(),P=!1;isNaN(A)||void 0==B?$j("#selectMenu option").remove():($j("#option_"+x(A,B,z)).prop("selected","selected"),TxnHandler.refreshOpenBets())};
TxnHandler.checkToHideOpenBets=function(){var a=DataBase.unMatchTicket.getByMarketId(null,null),c=DataBase.txn.getByMarketId(null,null),e=DataBase.sportsBookUnMatchTicket.getByMarketId(null,null),b=DataBase.sportsBookTxn.getByMarketId(null,null),f=DataBase.fancyBetTxn.getByMarketId(null,null),r=DataBase.bookMakerTxn.getByMarketId(null,null),p=DataBase.financialTxn.getByMarketId(null,null);0==a.length&&0==c.length&&0==e.length&&0==b.length&&0==f.length&&0==r.length&&0==p.length?(JsCache.get(".matched-wrap").hide(),
JsCache.get(".slip-wrap").addClass("no-open-bet_slip")):(JsCache.get(".matched-wrap").show(),JsCache.get(".slip-wrap").removeClass("no-open-bet_slip"))};TxnHandler.getUnMatchTicketsAndTxnsTask=function(){this.task=TaskExecuter.createTask(1,0,function(){F(this)});this.task.unMatchTicketVersion=0;this.task.txnVersion=0;this.task.sportsBookUnMatchTicketVersion=0;this.task.sportsBookTxnVersion=0;this.task.fancyBetTxnVersion=0;this.task.bookMakerTxnVersion=0;this.task.financialTxnVersion=0;this.task.refresh=
function(){this.cycleTick=0};this.task.reset=function(){this.financialTxnVersion=this.bookMakerTxnVersion=this.fancyBetTxnVersion=this.sportsBookTxnVersion=this.sportsBookUnMatchTicketVersion=this.txnVersion=this.unMatchTicketVersion=0};this.refresh=function(){this.task.refresh()};this.reset=function(){this.task.reset()}};TxnHandler.getUnMatchTicketsAndTxns=function(){$j.ajax({type:"POST",dataType:"JSON",url:(PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost?QueryDataSubDomainUtil.queryHost:
"")+"/member/playerService/queryUnMatchTicketsAndTxns",data:{unMatchTicketVersion:TxnHandler.unTask.task.unMatchTicketVersion,txnVersion:TxnHandler.unTask.task.txnVersion,sportsBookUnMatchTicketVersion:TxnHandler.unTask.task.sportsBookUnMatchTicketVersion,sportsBookTxnVersion:TxnHandler.unTask.task.sportsBookTxnVersion,fancyBetTxnVersion:TxnHandler.unTask.task.fancyBetTxnVersion,bookMakerTxnVersion:TxnHandler.unTask.task.bookMakerTxnVersion,financialTxnVersion:TxnHandler.unTask.task.financialTxnVersion,
queryPass:PageConfig.queryPass},xhrFields:{withCredentials:!0},success:function(a){try{if(null!=a){var c=!1;0<a.unMatchTickets.length&&(DataBase.unMatchTicket.update(a.unMatchTickets),E(),c=!0);0<a.txns.length&&(DataBase.txn.update(a.txns),n(),c=!0);0<a.sportsBookUnMatchTickets.length&&(DataBase.sportsBookUnMatchTicket.update(a.sportsBookUnMatchTickets),E(),c=!0);0<a.sportsBookTxns.length&&(DataBase.sportsBookTxn.update(a.sportsBookTxns),n(),c=!0);0<a.fancyBetTxns.length&&(DataBase.fancyBetTxn.update(a.fancyBetTxns),
n(),c=!0);0<a.bookMakerTxns.length&&(DataBase.bookMakerTxn.update(a.bookMakerTxns),n(),c=!0);0<a.financialTxns.length&&(DataBase.financialTxn.update(a.financialTxns),n(),c=!0);c&&!BetHandler.isOnBetting&&(TxnHandler.updateOpenBetSelectionBox(),TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId),TxnHandler.checkToHideOpenBets())}}catch(e){Trace.printStackTrace(e)}},error:function(){PageConfig.enableQueryDataSubdomain&&null!=QueryDataSubDomainUtil.queryHost&&!QueryDataSubDomainUtil.isLineDown&&
(QueryDataSubDomainUtil.queryHost=null,QueryDataSubDomainUtil.isLineDown=!0)}})};TxnHandler.clickEditBetBtn=function(){l();JsCache.get("#unMatchTicketList").hide();JsCache.get("#editUnMatchedList").show();JsCache.get("#unMatchFullBtn").hide();JsCache.get("#editUnMatchFullBtn").show();var a=$j("[id^=editUnMatched_]");null!=a&&0<a.length&&$j(a[0]).find("#odds").select();var c=$j("#editUnMatchedList");$j.each(a,function(e,b){b=c.find(b);e=DataBase.unMatchTicket.get(b.attr("unMatchTicketId"));b.prop("lastPriceBeforeEditBet",
e.lastPrice)})};TxnHandler.clickResetBtn=function(){TxnHandler.userIsEditPersistence=!1;TxnHandler.listEnableInput();JsCache.get("#unMatchTicketList").show();JsCache.get("#editUnMatchedList").hide();JsCache.get("#unMatchFullBtn").show();JsCache.get("#editUnMatchFullBtn").hide();TxnHandler.refreshOpenBets();TxnHandler.resetMessage()};TxnHandler.validEditBetMin=function(a,c){var e=CurrencyType.getInstanceOf(PageConfig.playerCurrency);if(null==e)return!1;e=e.editBetMin;a=DataBase.unMatchTicket.get(a);
if(null==a||null==e)return!1;if(c==a.lastPrice)return!0;c=MathUtil.decimal.subtract(c,a.lastPrice);0>c&&(c=MathUtil.decimal.multiply(-1,c));return c<e?!1:!0};TxnHandler.validComma=function(a){a.val(a.val().replace(/[^\d.]/g,"").replace(/^\./g,""))};TxnHandler.commonEvent=function(a){TxnHandler.oddsAndStakeCheck(a);TxnHandler.disableOtherInput(a);0==TxnHandler.checkDataIsEdited(a)&&(TxnHandler.enableInput(a),TxnHandler.resetMessage());TxnHandler.calculateEditLiability(a)};TxnHandler.getDynamicMinBet=
function(a){var c=BetHandler.getMinBet(a.attr("eventId"),a.attr("marketId"),a.attr("eventType"),a.find("#odds").val());a.find("#dynamicMinBet").html(c)};TxnHandler.resetMessage=function(){JsCache.get("#editErrorMsg").hide();JsCache.get("#editBetMsg").hide();JsCache.get("#openBetSlip").find("[id^='stakeTipsPopup']").hide();JsCache.get("#openBetSlip").find("[id^='oddsTipsPopup']").hide()};TxnHandler.calculateEditLiability=function(a){var c=a.find("#odds").val(),e=a.find("#inputStake").val();c=UnMatchTicketUtil.getPL(c,
e);e=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:e.symbol});a.find("#profitLiability").html(CurrencyUtil.formatter(c))};TxnHandler.oddsAndStakeCheck=function(a){var c=$j("[id^='editUnMatched_']"),e=!0;$j.each(c,function(f,r){r=$j(r);if(r.hasClass("sum")||r.is(":hidden")||0==TxnHandler.checkDataIsEdited(r))return!0;var p=r.find("#odds").val();f=r.find("#inputStake").val();if(!p||!f)return!0;if(1==BetHandler.isLessThanMinOdds(p))return JsCache.get("#editErrorMsg").html(I18N.get("msg.member.odds.minOdds")).show(),
1==e&&(e=!1),!0;r=DataBase.unMatchTicket.get(r.attr("unMatchTicketId"));if(null==r)return!0;p=BetHandler.getMinBet(r.eventId,r.marketId,r.eventType,r.odds);if(r.lastPrice<p)return!0;if(f<p)return JsCache.get("#editErrorMsg").html(I18N.get("msg.member.minBet")).show(),1==e&&(e=!1),!0});1==e&&JsCache.get("#editErrorMsg").hide();if(null!=a){c=DataBase.unMatchTicket.get(a.attr("unMatchTicketId"));var b=BetHandler.getMinBet(c.eventId,c.marketId,c.eventType,c.odds);c.lastPrice>=b&&1==BetHandler.isLessThanMinStake(a,
JsCache.get("#editUnMatchedList"))||(1==BetHandler.isLessThanMinOdds(a.find("#odds").val())?BetHandler.showOddsTips(a,JsCache.get("#editUnMatchedList")):BetHandler.hideOddsTips(a))}};TxnHandler.disableOtherInput=function(a){var c=TxnHandler.getNewPersistenceType(a),e=a.find("#odds").val(),b=a.find("#inputStake").val(),f=DataBase.unMatchTicket.get(a.attr("unMatchTicketId"));c!=a.attr("persistenceType")?(a.find("#inputStake").prop("disabled",!0).addClass("disable"),a.find("#odds").prop("disabled",!0).addClass("disable"),
a.find("ul").addClass("disable")):e!=f.odds?(a.find("#inputStake").prop("disabled",!0).addClass("disable"),a.find("[name=keepOption]").prop("disabled",!0).addClass("disable")):b!=f.lastPrice&&(a.find("#odds").prop("disabled",!0).addClass("disable"),a.find("ul").addClass("disable"),a.find("[name=keepOption]").prop("disabled",!0).addClass("disable"))};TxnHandler.enableInput=function(a){a.find("#odds").prop("disabled",!1).removeClass("disable");a.find("ul").removeClass("disable");a.find("#inputStake").prop("disabled",
!1).removeClass("disable");a.find("[name=keepOption]").prop("disabled",!1).removeClass("disable")};TxnHandler.listEnableInput=function(){var a=$j("[id^='editUnMatched_']");$j.each(a,function(c,e){e=$j(e);TxnHandler.enableInput(e)})};TxnHandler.checkDataIsEdited=function(a){var c=a.find("#odds").val(),e=a.find("#inputStake").val(),b=DataBase.unMatchTicket.get(a.attr("unMatchTicketId"));a=TxnHandler.getNewPersistenceType(a);return null==b?!1:c!=b.odds|e!=b.lastPrice|a!=b.persistenceType};TxnHandler.getNewPersistenceType=
function(a){if(1==a.find("#cancel").prop("checked"))return PersistenceType.Lapse.unique();if(1==a.find("#keep").prop("checked"))return PersistenceType.Persist.unique()};TxnHandler.selectKeepOption=function(a,c){a=a.find("#keepOptionBox");a.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex");PersistenceType.Lapse.unique()==c?(a.find("#cancel").attr("checked",!0),a.find("#keep").attr("tabindex",-1)):PersistenceType.Persist.unique()==c&&(a.find("#keep").attr("checked",!0),a.find("#cancel").attr("tabindex",
-1))};TxnHandler.updateUnMatchTicketList=function(){TxnHandler.userIsEditPersistence=!1;TxnHandler.listEnableInput();JsCache.get("#editAllBets").show();JsCache.get("#editErrorMsg").hide();JsCache.get("#unMatchTicketList").show();JsCache.get("#editUnMatchedList").hide();JsCache.get("#unMatchFullBtn").show();JsCache.get("#editUnMatchFullBtn").hide();var a=JsCache.get("#editUnMatchedList").find("[id^=editUnMatched_]"),c=[];$j.each(a,function(e,b){b=$j(b);if(null==b.attr("unMatchTicketId")||null==b.find("#odds")||
null==b.find("#inputStake"))return!0;var f=e=!1,r=!1,p=b.attr("unMatchTicketId"),m=b.attr("persistenceType"),t=parseFloat(b.find("#odds").val())||0,q=parseFloat(b.find("#inputStake").val())||0;if(!MathUtil.isNumeric(b.find("#odds").val(),!0,!1)||1.01>t)return b.find("#odds").val(1.01),!0;if(1E3<t)return b.find("#odds").val(1E3),TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds")),!0;if(!MathUtil.isNumeric(b.find("#inputStake").val(),!0,!1)||0==q)return b.find("#inputStake").val(""),
!0;if(!TxnHandler.validEditBetMin(b.attr("unMatchTicketId"),q))return TxnHandler.showEditBetMsg(I18N.get("msg.member.editBet.warning")),!0;var v=TxnHandler.getNewPersistenceType(b),G=DataBase.unMatchTicket.get(p),I=BetHandler.getMinBet(b.attr("eventId"),b.attr("marketId"),b.attr("eventType"),t);if(G.lastPrice>=I&&q<I)return!0;v!=m?e=!0:t!=G.odds?f=!0:q!=G.lastPrice&&(r=!0);if(!e&&!f&&!r)return!0;p={unMatchTicketId:p,eventId:b.attr("eventId"),marketId:b.attr("marketId")};p.lastPriceBeforeEditBet=parseFloat(b.prop("lastPriceBeforeEditBet"))||
0;e?p.newPersistenceType=v:f?p.newOdds=t:r&&(p.newStake=q);c.push(p)});TxnHandler.submitUpdate(c);TxnHandler.unTask.reset();TxnHandler.unTask.refresh()};TxnHandler.showEditErrorMsg=function(a){JsCache.get("#editErrorMsg").html(a).fadeIn();setTimeout(function(){JsCache.get("#editErrorMsg").fadeOut()},3E3)};TxnHandler.showEditBetMsg=function(a){JsCache.get("#editBetMsg").html(a).fadeIn();setTimeout(function(){JsCache.get("#editBetMsg").fadeOut()},3E3)};TxnHandler.submitUpdate=function(a){JsCache.get("#editBetMsg").hide();
JsCache.get("#openBetSlip").find("[id^='stakeTipsPopup']").hide();JsCache.get("#openBetSlip").find("[id^='oddsTipsPopup']").hide();0!=a.length&&$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/updateUnMatchTicket",data:{updateUnMatchTickets:JSON.stringify(a)},beforeSend:function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide()},success:function(c){try{if(c.error)TxnHandler.showEditErrorMsg(c.error);else if(0!=c.result.length)for(var e in c.result){var b=c.result[e];
"SUCCESS"==b.status?(null!=b.unMatchTicket&&DataBase.unMatchTicket.update([b.unMatchTicket]),null!=b.txn&&DataBase.txn.update([b.txn])):b.error&&TxnHandler.showEditErrorMsg(b.error)}}catch(f){Trace.printStackTrace(f)}finally{TxnHandler.unTask.reset(),TxnHandler.unTask.refresh(),setTimeout(function(){JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show();TxnHandler.refreshOpenBets()},1E3),TxnHandler.listEnableInput()}},error:function(c){Trace.printStackTrace(c)}})};TxnHandler.cancelAllUnMatchTickets=
function(a){a=JsCache.get("#unMatchTicketList").find("dl");var c=[];$j.each(a,function(e,b){e=$j(b);if(e.hasClass("sum")||e.is(":hidden")||null==e.attr("unMatchTicketId")||null==e.attr("eventId")||null==e.attr("marketId"))return!0;c.push({unMatchTicketId:e.attr("unMatchTicketId"),eventId:e.attr("eventId"),marketId:e.attr("marketId")})});TxnHandler.userIsEditPersistence=!1;w(c)};TxnHandler.appendInningRuns=function(a,c){var e=a.find("#inningsRuns");a=c.selectionName.toLowerCase();e.find("#ifRuns").html("If "+
a);e.find("#ifLess").html("If less than "+a.replace("or more",""));e.show();a=e.find("#runsPL");e=e.find("#lessPL");if(null!=a&&null!=e){if(SideType.Back.unique()==SideType.getInstanceOf(c.sideType).unique()){var b=c.profit;c=-1*c.liability}else b=-1*c.liability,c=c.profit;a.html(CurrencyUtil.formatter(b));e.html(CurrencyUtil.formatter(c));a.removeClass("green").removeClass("red");e.removeClass("green").removeClass("red");0<=b?a.addClass("green"):a.addClass("red");0<=c?e.addClass("green"):e.addClass("red")}};
TxnHandler.getRemovedMarketsTask=TaskExecuter.createTask(5,0,function(){R(this)});TxnHandler.getUnMatchTicketByCategoryType=function(a,c,e,b){return CategoryType.SPORTRADAR_SPORTSBOOK.unique()==b||CategoryType.OW_SPORTSBOOK.unique()==b?DataBase.sportsBookUnMatchTicket.getByMarketId(a,c,e,b):DataBase.unMatchTicket.getByMarketId(a,c,e,b)};TxnHandler.getMarketTxnByCategoryType=function(a,c,e,b,f){return CategoryType.SPORTRADAR_SPORTSBOOK.unique()==f||CategoryType.OW_SPORTSBOOK.unique()==f?DataBase.sportsBookTxn.getByMarketId(a,
c,e,b,f):CategoryType.FANCY_BET.unique()==f?DataBase.fancyBetTxn.getByMarketId(a,c,e,b,f):CategoryType.BOOK_MAKER.unique()==f?DataBase.bookMakerTxn.getByMarketId(a,c,e,b,f):CategoryType.TS_BINARY.unique()==f?DataBase.financialTxn.getByMarketId(a,c,e,b,f):DataBase.txn.getByMarketId(a,c,e,b,f)}})();"undefined"==typeof DataBase&&(DataBase={});
(function(){DataBase.unMatchTicket={};var x=new TreeMap;DataBase.unMatchTicket.update=function(g){var l=!1,d;for(d in g){var h=g[d],k=x.get(h.id);null==k&&(l=!0);null!=k&&(k.status!=h.status&&(l=!0),x.remove(h.id));UnMatchTicketUtil.isActive(h.status)&&(k=h.eventId+";"+h.marketId.replace("_",".")+";"+h.categoryType,-1==ArrayUtil.indexOf(TxnHandler.marketPks,k)&&TxnHandler.marketPks.push(k));x.put(h.id,h)}return l};DataBase.unMatchTicket.add=function(g){return x.put(g.id,g)};DataBase.unMatchTicket.get=
function(g){return x.get(g)};DataBase.unMatchTicket.getByEventId=function(g,l){var d=[];$j.each(x.values(),function(h,k){if(UnMatchTicketUtil.isDelete(k.status)||UnMatchTicketUtil.isLapsed(k.status)||1==k.summary||0==k.lastPrice)return!0;g==k.eventId&&l==k.categoryType&&d.push(k)});return d};DataBase.unMatchTicket.getByMarketId=function(g,l,d,h){var k=[];$j.each(x.values(),function(w,n){if(UnMatchTicketUtil.isDelete(n.status)||UnMatchTicketUtil.isLapsed(n.status)||1==n.summary||0==n.lastPrice)return!0;
if(null==g&&null==l)k.push(n);else{if(null!=d&&n.sideType!=d)return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&h==n.categoryType&&k.push(n)}});return k};DataBase.unMatchTicket.getBySelectionId=function(g,l,d,h){var k=[];$j.each(x.values(),function(w,n){if(UnMatchTicketUtil.isDelete(n.status)||UnMatchTicketUtil.isLapsed(n.status))return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionKey&&h==n.categoryType&&k.push(n)});return k};DataBase.unMatchTicket.calculatePL=
function(){var g=x.keySet(),l;for(l in g){var d=x.get(g[l]),h=MathUtil.roundp(d.lastPrice,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=UnMatchTicketUtil.getPL(d.odds,h),d.liability=h):SideType.Lay.unique()==k.value&&(d.profit=h,d.liability=UnMatchTicketUtil.getPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.unMatchTicket.summaryByMarketPk=function(g){g=DataBase.unMatchTicket.getByMarketId(g.eventId,g.marketId,null,g.categoryType);
$j.each(g,function(l,d){l=x.get(d.id);l.summary=1;l.status=UnMatchTicketStatusType.Delete.unique()})};DataBase.unMatchTicket.marketChangeToInPlay=function(g){g=DataBase.unMatchTicket.getByMarketId(g.eventId,g.marketId,null,g.categoryType);$j.each(g,function(l,d){x.get(d.id).inPlay=1})};DataBase.unMatchTicket.getActiveTickets=function(g,l,d,h){var k=[];$j.each(x.values(),function(w,n){if(!UnMatchTicketUtil.isActive(n.status))return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==
n.selectionKey&&h==n.sideType&&k.push(n)});return k};DataBase.unMatchTicket.queryAll=function(){return x.values()};DataBase.unMatchTicket.size=function(){return x.length};DataBase.txn={};var y=new TreeMap;DataBase.txn.update=function(g){for(var l in g){var d=g[l];null!=y.get(d.id)&&y.remove(d.id);if(MyTransactionUtils.isActive(d.status)){var h=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;-1==ArrayUtil.indexOf(TxnHandler.marketPks,h)&&TxnHandler.marketPks.push(h)}y.put(d.id,d)}};DataBase.txn.add=
function(g){return y.put(g.id,g)};DataBase.txn.get=function(g){return y.get(g)};DataBase.txn.getByEventId=function(g,l){var d=[];$j.each(y.values(),function(h,k){if(MyTransactionStatusType.Active.unique()!=k.status||1==k.summary)return!0;g==k.eventId&&l==k.categoryType&&d.push(k)});return d};DataBase.txn.getByMarketId=function(g,l,d,h,k){var w=[];$j.each(y.values(),function(n,u){if(null==h||0==h.length){if(MyTransactionStatusType.Active.unique()!=u.status)return!0}else if(!MyTransactionUtils.isContainsStatus(h,
u.status))return!0;if(1==u.summary)return!0;if(null==g&&null==l)w.push(u);else{if(null!=d&&u.sideType!=d)return!0;g==u.eventId&&l.replace("_",".")==u.marketId.replace("_",".")&&k==u.categoryType&&w.push(u)}});return w};DataBase.txn.getBySelectionId=function(g,l,d,h){var k=[];$j.each(y.values(),function(w,n){if(MyTransactionStatusType.Active.unique()!=n.status)return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionKey&&h==n.categoryType&&k.push(n)});return k};DataBase.txn.calculatePL=
function(){var g=y.keySet(),l;for(l in g){var d=y.get(g[l]),h=MathUtil.roundp(d.stake,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=UnMatchTicketUtil.getPL(d.odds,h),d.liability=h):SideType.Lay.unique()==k.value&&(d.profit=h,d.liability=UnMatchTicketUtil.getPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.txn.summaryByMarketPk=function(g){g=DataBase.txn.getByMarketId(g.eventId,g.marketId,null,null,g.categoryType);$j.each(g,
function(l,d){l=y.get(d.id);l.summary=1;l.status=MyTransactionStatusType.Settle.unique()})};DataBase.txn.queryAll=function(){return y.values()};DataBase.txn.size=function(){return y.length};DataBase.sportsBookUnMatchTicket={};var D=new TreeMap;DataBase.sportsBookUnMatchTicket.update=function(g){var l=!1,d;for(d in g){var h=g[d],k=D.get(h.id);null==k&&(l=!0);null!=k&&(k.status!=h.status&&(l=!0),D.remove(h.id));UnMatchTicketUtil.isActive(h.status)&&(k=h.eventId+";"+h.marketId.replace("_",".")+";"+h.categoryType,
-1==ArrayUtil.indexOf(TxnHandler.marketPks,k)&&TxnHandler.marketPks.push(k));D.put(h.id,h)}return l};DataBase.sportsBookUnMatchTicket.add=function(g){return D.put(g.id,g)};DataBase.sportsBookUnMatchTicket.get=function(g){return D.get(g)};DataBase.sportsBookUnMatchTicket.getByEventId=function(g,l){var d=[];$j.each(D.values(),function(h,k){if(UnMatchTicketUtil.isDelete(k.status)||UnMatchTicketUtil.isLapsed(k.status)||1==k.summary||0==k.lastPrice)return!0;g==k.eventId&&l==k.categoryType&&d.push(k)});
return d};DataBase.sportsBookUnMatchTicket.getByMarketId=function(g,l,d,h){var k=[];$j.each(D.values(),function(w,n){if(UnMatchTicketUtil.isDelete(n.status)||UnMatchTicketUtil.isLapsed(n.status)||1==n.summary||0==n.lastPrice)return!0;if(null==g&&null==l)k.push(n);else{if(null!=d&&n.sideType!=d)return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&h==n.categoryType&&k.push(n)}});return k};DataBase.sportsBookUnMatchTicket.getBySelectionId=function(g,l,d,h){var k=[];$j.each(D.values(),
function(w,n){if(UnMatchTicketUtil.isDelete(n.status)||UnMatchTicketUtil.isLapsed(n.status))return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionId&&h==n.categoryType&&k.push(n)});return k};DataBase.sportsBookUnMatchTicket.calculatePL=function(){var g=D.keySet(),l;for(l in g){var d=D.get(g[l]),h=MathUtil.roundp(d.lastPrice,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=UnMatchTicketUtil.getPL(d.odds,h),d.liability=h):SideType.Lay.unique()==
k.value&&(d.profit=h,d.liability=UnMatchTicketUtil.getPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.sportsBookUnMatchTicket.summaryByMarketPk=function(g){g=DataBase.sportsBookUnMatchTicket.getByMarketId(g.eventId,g.marketId,null,g.categoryType);$j.each(g,function(l,d){l=D.get(d.id);l.summary=1;l.status=UnMatchTicketStatusType.Delete.unique()})};DataBase.sportsBookUnMatchTicket.marketChangeToInPlay=function(g){g=DataBase.sportsBookUnMatchTicket.getByMarketId(g.eventId,
g.marketId,null,g.categoryType);$j.each(g,function(l,d){D.get(d.id).inPlay=1})};DataBase.sportsBookUnMatchTicket.queryAll=function(){return D.values()};DataBase.sportsBookUnMatchTicket.size=function(){return D.length};DataBase.sportsBookTxn={};var F=new TreeMap;DataBase.sportsBookTxn.update=function(g){for(var l in g){var d=g[l];null!=F.get(d.id)&&F.remove(d.id);if(MyTransactionUtils.isActive(d.status)){var h=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;-1==ArrayUtil.indexOf(TxnHandler.marketPks,
h)&&TxnHandler.marketPks.push(h)}F.put(d.id,d)}};DataBase.sportsBookTxn.add=function(g){return F.put(g.id,g)};DataBase.sportsBookTxn.get=function(g){return F.get(g)};DataBase.sportsBookTxn.getByEventId=function(g,l){var d=[];$j.each(F.values(),function(h,k){if(MyTransactionStatusType.Active.unique()!=k.status||1==k.summary)return!0;g==k.eventId&&l==k.categoryType&&d.push(k)});return d};DataBase.sportsBookTxn.getByMarketId=function(g,l,d,h,k){var w=[];$j.each(F.values(),function(n,u){if(null==h||0==
h.length){if(MyTransactionStatusType.Active.unique()!=u.status)return!0}else if(!MyTransactionUtils.isContainsStatus(h,u.status))return!0;if(1==u.summary)return!0;if(null==g&&null==l)w.push(u);else{if(null!=d&&u.sideType!=d)return!0;g==u.eventId&&l.replace("_",".")==u.marketId.replace("_",".")&&k==u.categoryType&&w.push(u)}});return w};DataBase.sportsBookTxn.getBySelectionId=function(g,l,d,h){var k=[];$j.each(F.values(),function(w,n){if(MyTransactionStatusType.Active.unique()!=n.status)return!0;g==
n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionId&&h==n.categoryType&&k.push(n)});return k};DataBase.sportsBookTxn.calculatePL=function(){var g=F.keySet(),l;for(l in g){var d=F.get(g[l]),h=MathUtil.roundp(d.stake,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=UnMatchTicketUtil.getPL(d.odds,h),d.liability=h):SideType.Lay.unique()==k.value&&(d.profit=h,d.liability=UnMatchTicketUtil.getPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&
(h=0);d.stakeOdds=h}};DataBase.sportsBookTxn.summaryByMarketPk=function(g){g=DataBase.sportsBookTxn.getByMarketId(g.eventId,g.marketId,null,null,g.categoryType);$j.each(g,function(l,d){l=F.get(d.id);l.summary=1;l.status=MyTransactionStatusType.Settle.unique()})};DataBase.sportsBookTxn.queryAll=function(){return F.values()};DataBase.sportsBookTxn.size=function(){return F.length};DataBase.fancyBetTxn={};var C=new TreeMap;DataBase.fancyBetTxn.update=function(g){for(var l in g){var d=g[l];null!=C.get(d.id)&&
C.remove(d.id);if(MyTransactionUtils.isActive(d.status)){var h=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;-1==ArrayUtil.indexOf(TxnHandler.marketPks,h)&&TxnHandler.marketPks.push(h)}C.put(d.id,d)}};DataBase.fancyBetTxn.add=function(g){return C.put(g.id,g)};DataBase.fancyBetTxn.get=function(g){return C.get(g)};DataBase.fancyBetTxn.getByEventId=function(g,l){var d=[];$j.each(C.values(),function(h,k){if(MyTransactionStatusType.Active.unique()!=k.status||1==k.summary)return!0;g==k.eventId&&
l==k.categoryType&&d.push(k)});return d};DataBase.fancyBetTxn.getByMarketId=function(g,l,d,h,k){var w=[];$j.each(C.values(),function(n,u){if(null==h||0==h.length){if(MyTransactionStatusType.Active.unique()!=u.status)return!0}else if(!MyTransactionUtils.isContainsStatus(h,u.status))return!0;if(1==u.summary)return!0;if(null==g&&null==l)w.push(u);else{if(null!=d&&u.sideType!=d)return!0;g==u.eventId&&l.replace("_",".")==u.marketId.replace("_",".")&&k==u.categoryType&&w.push(u)}});return w};DataBase.fancyBetTxn.getBySelectionId=
function(g,l,d,h){var k=[];$j.each(C.values(),function(w,n){if(MyTransactionStatusType.Active.unique()!=n.status)return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionId&&h==n.categoryType&&k.push(n)});return k};DataBase.fancyBetTxn.calculatePL=function(){var g=C.keySet(),l;for(l in g){var d=C.get(g[l]),h=MathUtil.roundp(d.stake,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=MyTransactionUtils.getFancyBetPL(d.odds,h),d.liability=h):
SideType.Lay.unique()==k.value&&(d.profit=h,d.liability=MyTransactionUtils.getFancyBetPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.fancyBetTxn.summaryByMarketPk=function(g){g=DataBase.fancyBetTxn.getByMarketId(g.eventId,g.marketId,null,null,g.categoryType);$j.each(g,function(l,d){l=C.get(d.id);l.summary=1;l.status=MyTransactionStatusType.Settle.unique()})};DataBase.fancyBetTxn.queryAll=function(){return C.values()};DataBase.fancyBetTxn.size=function(){return C.length};
DataBase.bookMakerTxn={};var E=new TreeMap;DataBase.bookMakerTxn.update=function(g){for(var l in g){var d=g[l];null!=E.get(d.id)&&E.remove(d.id);if(MyTransactionUtils.isActive(d.status)){var h=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;-1==ArrayUtil.indexOf(TxnHandler.marketPks,h)&&TxnHandler.marketPks.push(h)}E.put(d.id,d)}};DataBase.bookMakerTxn.add=function(g){return E.put(g.id,g)};DataBase.bookMakerTxn.get=function(g){return E.get(g)};DataBase.bookMakerTxn.getByEventId=function(g,
l){var d=[];$j.each(E.values(),function(h,k){if(MyTransactionStatusType.Active.unique()!=k.status||1==k.summary)return!0;g==k.eventId&&l==k.categoryType&&d.push(k)});return d};DataBase.bookMakerTxn.getByMarketId=function(g,l,d,h,k){var w=[];$j.each(E.values(),function(n,u){if(null==h||0==h.length){if(MyTransactionStatusType.Active.unique()!=u.status)return!0}else if(!MyTransactionUtils.isContainsStatus(h,u.status))return!0;if(1==u.summary)return!0;if(null==g&&null==l)w.push(u);else{if(null!=d&&u.sideType!=
d)return!0;g==u.eventId&&l.replace("_",".")==u.marketId.replace("_",".")&&k==u.categoryType&&w.push(u)}});return w};DataBase.bookMakerTxn.getBySelectionId=function(g,l,d,h){var k=[];$j.each(E.values(),function(w,n){if(MyTransactionStatusType.Active.unique()!=n.status)return!0;g==n.eventId&&l.replace("_",".")==n.marketId.replace("_",".")&&d==n.selectionId&&h==n.categoryType&&k.push(n)});return k};DataBase.bookMakerTxn.calculatePL=function(){var g=E.keySet(),l;for(l in g){var d=E.get(g[l]),h=MathUtil.roundp(d.stake,
2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(BookMakerTransactionUtils.isFancyBetPLEventType(d.eventType)?d.profit=MyTransactionUtils.getFancyBetPL(d.odds,h):d.profit=UnMatchTicketUtil.getPL(d.odds,h),d.liability=h):SideType.Lay.unique()==k.value&&(BookMakerTransactionUtils.isFancyBetPLEventType(d.eventType)?(d.profit=h,d.liability=MyTransactionUtils.getFancyBetPL(d.odds,h)):(d.profit=h,d.liability=UnMatchTicketUtil.getPL(d.odds,h)));h=MathUtil.decimal.multiply(d.odds,
h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.bookMakerTxn.summaryByMarketPk=function(g){g=DataBase.bookMakerTxn.getByMarketId(g.eventId,g.marketId,null,null,g.categoryType);$j.each(g,function(l,d){l=E.get(d.id);l.summary=1;l.status=MyTransactionStatusType.Settle.unique()})};DataBase.bookMakerTxn.queryAll=function(){return E.values()};DataBase.bookMakerTxn.size=function(){return E.length};DataBase.financialTxn={};var H=new TreeMap;DataBase.financialTxn.update=function(g){for(var l in g){var d=g[l];
null!=H.get(d.id)&&H.remove(d.id);if(MyTransactionUtils.isActive(d.status)){var h=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;-1==ArrayUtil.indexOf(TxnHandler.marketPks,h)&&TxnHandler.marketPks.push(h)}H.put(d.id,d)}};DataBase.financialTxn.add=function(g){return H.put(g.id,g)};DataBase.financialTxn.get=function(g){return H.get(g)};DataBase.financialTxn.getByEventId=function(g,l){var d=[];$j.each(H.values(),function(h,k){if(MyTransactionStatusType.Active.unique()!=k.status||1==k.summary)return!0;
g==k.eventId&&l==k.categoryType&&d.push(k)});return d};DataBase.financialTxn.getByMarketId=function(g,l,d,h,k){var w=[];$j.each(H.values(),function(n,u){if(null==h||0==h.length){if(MyTransactionStatusType.Active.unique()!=u.status)return!0}else if(!MyTransactionUtils.isContainsStatus(h,u.status))return!0;if(1==u.summary)return!0;if(null==g&&null==l)w.push(u);else{if(null!=d&&u.sideType!=d)return!0;g==u.eventId&&l.replace("_",".")==u.marketId.replace("_",".")&&k==u.categoryType&&w.push(u)}});return w};
DataBase.financialTxn.calculatePL=function(){var g=H.keySet(),l;for(l in g){var d=H.get(g[l]),h=MathUtil.roundp(d.stake,2),k=SideType.getInstanceOf(d.sideType);SideType.Back.unique()==k.value?(d.profit=MyTransactionUtils.getFancyBetPL(d.odds,h),d.liability=h):SideType.Lay.unique()==k.value&&(d.profit=h,d.liability=MyTransactionUtils.getFancyBetPL(d.odds,h));h=MathUtil.decimal.multiply(d.odds,h);isNaN(h)&&(h=0);d.stakeOdds=h}};DataBase.financialTxn.summaryByMarketPk=function(g){g=DataBase.financialTxn.getByMarketId(g.eventId,
g.marketId,null,null,g.categoryType);$j.each(g,function(l,d){l=H.get(d.id);l.summary=1;l.status=MyTransactionStatusType.Settle.unique()})};DataBase.financialTxn.queryAll=function(){return H.values()};DataBase.financialTxn.size=function(){return H.length}})();function outOfScale(x,y){x=(""+x).split(".");return 1<x.length&&x[1].length>y}
;
